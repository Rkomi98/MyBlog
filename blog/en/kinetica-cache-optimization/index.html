<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cache Optimization with Kinetica</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }
    html {
      scroll-behavior: smooth;
    }
    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(120% 120% at 50% 0%, rgba(59, 130, 246, 0.18) 0%, transparent 65%), var(--bg-primary);
      color: var(--text-primary);
      transition: background 0.3s ease, color 0.3s ease;
      --bg-primary: #0f172a;
      --bg-secondary: #111c33;
      --bg-card: rgba(15, 23, 42, 0.78);
      --bg-card-strong: rgba(15, 23, 42, 0.9);
      --border: rgba(148, 163, 184, 0.24);
      --text-primary: #e2e8f0;
      --text-secondary: #cbd5f5;
      --text-muted: #94a3b8;
      --accent: #60a5fa;
      --accent-strong: #38bdf8;
      --shadow-lg: 0 28px 60px -36px rgba(15, 23, 42, 0.9);
    }
    body[data-theme="light"] {
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-card: rgba(255, 255, 255, 0.96);
      --bg-card-strong: rgba(248, 250, 252, 0.98);
      --border: rgba(148, 163, 184, 0.18);
      --text-primary: #0f172a;
      --text-secondary: #334155;
      --text-muted: #64748b;
      --accent: #2563eb;
      --accent-strong: #1d4ed8;
      --shadow-lg: 0 28px 50px -38px rgba(15, 23, 42, 0.18);
      background: radial-gradient(120% 120% at 50% 0%, rgba(59, 130, 246, 0.12) 0%, transparent 60%), var(--bg-primary);
    }
    body[data-theme="light"] .post-toc {
      background: rgba(255, 255, 255, 0.96);
    }
    body[data-theme="light"] .post-body {
      background: rgba(255, 255, 255, 0.96);
      color: var(--text-secondary);
    }
    body[data-theme="light"] .post-hero__category {
      background: rgba(37, 99, 235, 0.12);
      color: var(--accent-strong);
    }
    body[data-theme="light"] .post-body blockquote {
      background: rgba(37, 99, 235, 0.1);
      color: var(--text-primary);
    }
    a {
      color: inherit;
      text-decoration: none;
    }
    header.site-header {
      position: sticky;
      top: 0;
      z-index: 12;
      backdrop-filter: blur(14px);
      background: rgba(15, 23, 42, 0.85);
      border-bottom: 1px solid var(--border);
      transition: background 0.3s ease;
    }
    body[data-theme="light"] header.site-header {
      background: rgba(248, 250, 252, 0.9);
    }
    .site-header__inner {
      max-width: 960px;
      margin: 0 auto;
      padding: 1.15rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.5rem;
    }
    .site-header__left {
      display: flex;
      align-items: center;
      gap: 1.75rem;
    }
    .logo {
      display: inline-flex;
      align-items: center;
      gap: 0.7rem;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 1.05rem;
      letter-spacing: 0.01em;
    }
    .logo-img {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      object-fit: cover;
      box-shadow: 0 8px 18px -12px rgba(15, 23, 42, 0.6);
    }
    .site-nav {
      display: flex;
      gap: 1.1rem;
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--text-muted);
    }
    .site-nav a:hover {
      color: var(--accent);
    }
    .header-controls {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .lang-btn {
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-primary);
      padding: 0.45rem 0.9rem;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease, border 0.2s ease, transform 0.2s ease;
    }
    .lang-btn:hover:not(.lang-btn--disabled) {
      background: var(--accent);
      color: #ffffff;
      transform: translateY(-1px);
      border-color: transparent;
    }
    .lang-btn--disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .theme-toggle {
      position: relative;
      width: 52px;
      height: 28px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      cursor: pointer;
      padding: 0;
      transition: background 0.3s ease, border 0.3s ease;
      display: flex;
      align-items: center;
    }
    .theme-toggle .theme-thumb {
      position: absolute;
      top: 50%;
      left: 4px;
      transform: translateY(-50%);
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #ffffff;
      color: #1f2937;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      transition: transform 0.3s ease, background 0.3s ease, color 0.3s ease;
      box-shadow: 0 6px 18px -8px rgba(15, 23, 42, 0.6);
    }
    body[data-theme="dark"] .theme-toggle .theme-thumb {
      transform: translate(20px, -50%);
      background: #1f2937;
      color: #f8fafc;
    }
    body[data-theme="dark"] .theme-toggle {
      background: rgba(37, 99, 235, 0.2);
      border-color: rgba(37, 99, 235, 0.3);
    }
    main.page {
      max-width: 960px;
      margin: 0 auto;
      padding: 3.5rem 2rem 4.5rem;
    }
    .post-hero {
      position: relative;
      overflow: hidden;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.22) 0%, rgba(14, 165, 233, 0.08) 60%), var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 28px;
      padding: 2.75rem;
      box-shadow: var(--shadow-lg);
      margin-bottom: 3rem;
    }
    .post-hero::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.22) 0%, transparent 55%);
      pointer-events: none;
    }
    .post-hero__icon {
      position: relative;
      font-size: 3.1rem;
      margin-bottom: 1.5rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .post-hero__category {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.4rem 1rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.35);
      color: #ffffff;
      font-weight: 600;
      letter-spacing: 0.02em;
      margin-bottom: 1.25rem;
      text-transform: uppercase;
      font-size: 0.8rem;
    }
    .post-hero__title {
      position: relative;
      margin: 0 0 1.25rem;
      font-size: clamp(2.4rem, 4vw, 3.2rem);
      letter-spacing: -0.025em;
      line-height: 1.2;
      color: var(--text-primary);
    }
    .post-hero__meta {
      position: relative;
      display: flex;
      flex-wrap: wrap;
      gap: 1.25rem;
      color: var(--text-muted);
      font-size: 0.95rem;
      font-weight: 500;
    }
    .post-hero__meta span {
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
    }
    .post-layout {
      display: grid;
      grid-template-columns: minmax(0, 260px) minmax(0, 1fr);
      gap: 2.5rem;
      align-items: flex-start;
    }
    .post-layout--single {
      grid-template-columns: minmax(0, 1fr);
    }
    .post-toc {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 22px;
      padding: 1.8rem 1.6rem;
      box-shadow: var(--shadow-lg);
      position: sticky;
      top: 120px;
      max-height: calc(100vh - 160px);
      overflow-y: auto;
    }
    .post-toc__title {
      text-transform: uppercase;
      font-size: 0.78rem;
      letter-spacing: 0.18em;
      font-weight: 700;
      color: var(--text-muted);
      margin-bottom: 1.2rem;
    }
    .post-toc__list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.65rem;
    }
    .post-toc__item.level-1 {
      padding-left: 1rem;
    }
    .post-toc__item.level-2 {
      padding-left: 2rem;
    }
    .post-toc__link {
      color: var(--text-secondary);
      font-size: 0.95rem;
      line-height: 1.4;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      border-bottom: 1px dashed transparent;
      transition: color 0.2s ease, border-bottom 0.2s ease, transform 0.2s ease;
    }
    .post-toc__link:hover {
      color: var(--accent);
      border-bottom-color: rgba(96, 165, 250, 0.4);
      transform: translateX(2px);
    }
    .post-toc__link--active {
      color: var(--accent-strong);
      border-bottom-color: var(--accent-strong);
    }
    .post-body {
      background: var(--bg-card-strong);
      border: 1px solid var(--border);
      border-radius: 26px;
      padding: 2.5rem;
      box-shadow: var(--shadow-lg);
      font-size: 1.04rem;
      line-height: 1.75;
      color: var(--text-secondary);
    }
    .post-body h2 {
      margin-top: 2.75rem;
      margin-bottom: 1.25rem;
      font-size: clamp(1.9rem, 3vw, 2.35rem);
      color: var(--text-primary);
      letter-spacing: -0.01em;
    }
    .post-body h3 {
      margin-top: 2.2rem;
      margin-bottom: 1rem;
      font-size: 1.5rem;
      color: var(--text-primary);
    }
    .post-body h4 {
      margin-top: 1.8rem;
      margin-bottom: 0.75rem;
      font-size: 1.2rem;
      color: var(--text-primary);
    }
    .post-body p {
      margin-bottom: 1.4rem;
    }
    .post-body ul,
    .post-body ol {
      margin: 1.4rem 0 1.4rem 1.4rem;
      padding: 0;
    }
    .post-body li {
      margin-bottom: 0.8rem;
    }
    .post-body a {
      color: var(--accent);
      text-decoration: none;
      border-bottom: 1px solid rgba(96, 165, 250, 0.35);
      transition: color 0.2s ease, border-bottom 0.2s ease;
    }
    .post-body a:hover {
      color: var(--accent-strong);
      border-bottom-color: var(--accent-strong);
    }
    .post-body blockquote {
      margin: 2rem 0;
      padding: 1.5rem 1.75rem;
      border-left: 4px solid var(--accent);
      border-radius: 0 18px 18px 0;
      background: rgba(37, 99, 235, 0.12);
      color: var(--text-primary);
    }
    .post-body code {
      background: rgba(15, 23, 42, 0.65);
      color: #f8fafc;
      padding: 0.2rem 0.45rem;
      border-radius: 6px;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      font-size: 0.9rem;
    }
    body[data-theme="light"] .post-body code {
      background: rgba(15, 23, 42, 0.08);
      color: #111827;
    }
    .post-body pre {
      background: rgba(15, 23, 42, 0.92);
      color: #f8fafc;
      padding: 1.2rem 1.4rem;
      border-radius: 18px;
      overflow-x: auto;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      font-size: 0.95rem;
      box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.12);
    }
    body[data-theme="light"] .post-body pre {
      background: #0f172a;
      color: #f8fafc;
    }
    .post-body img {
      max-width: 100%;
      border-radius: 18px;
      margin: 2.2rem 0;
      box-shadow: 0 24px 45px -28px rgba(15, 23, 42, 0.55);
    }
    .post-body table {
      width: 100%;
      border-collapse: collapse;
      margin: 2rem 0;
      background: rgba(15, 23, 42, 0.5);
      border-radius: 18px;
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.12);
    }
    .post-body tr {
      border-bottom: 1px solid rgba(148, 163, 184, 0.18);
    }
    .post-body th,
    .post-body td {
      padding: 0.9rem 1rem;
      text-align: left;
    }
    body[data-theme="light"] .post-body table {
      background: rgba(255, 255, 255, 0.9);
      box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.16);
    }
    footer {
      margin-top: 4rem;
      padding: 2rem 0;
      text-align: center;
      color: var(--text-muted);
      font-size: 0.92rem;
      border-top: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.35);
    }
    body[data-theme="light"] footer {
      background: rgba(255, 255, 255, 0.72);
    }
    @media (max-width: 1024px) {
      .site-header__inner {
        padding: 1rem 1.5rem;
      }
      main.page {
        padding: 2.75rem 1.5rem 4rem;
      }
      .post-layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .post-toc {
        position: static;
        max-height: none;
        margin-bottom: 2rem;
      }
    }
    @media (max-width: 720px) {
      .post-hero {
        padding: 2.1rem 1.65rem;
      }
      .post-body {
        padding: 1.9rem 1.5rem;
      }
      .site-header__inner {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
      }
      .site-header__left {
        justify-content: space-between;
      }
      .header-controls {
        align-self: flex-end;
      }
      .post-hero__title {
        font-size: clamp(2rem, 6vw, 2.6rem);
      }
    }
  </style>
</head>
<body data-theme="dark">
  <header class="site-header">
    <div class="site-header__inner">
      <div class="site-header__left">
        <a class="logo" href="../../../index.html">
          <img src="../../../Assets/Logo.png" alt="Mirko Calcaterra logo" class="logo-img">
          <span class="logo-text">Mirko Calcaterra</span>
        </a>
        <nav class="site-nav">
          <a href="../../../index.html" data-it="Home" data-en="Home">Home</a>
          <a href="../../../blog/index.html" data-it="Blog" data-en="Blog">Blog</a>
        </nav>
      </div>
      <div class="header-controls">
        <button class="lang-btn" type="button">EN</button>
        <button class="theme-toggle" type="button" aria-label="Toggle theme">
          <span class="theme-thumb">☀️</span>
        </button>
      </div>
    </div>
  </header>
  <main class="page">
    <article class="post">
      <section class="post-hero">
        <div class="post-hero__icon">💻</div>
        <span class="post-hero__category">Data Engineering</span>
        <h1 class="post-hero__title">Cache Optimization with Kinetica</h1>
        <div class="post-hero__meta">
          <span>📅 October 25, 2025</span>
          <span>⏱️ 10 min</span>
        </div>
      </section>
      <section class="post-layout">
        <aside class="post-toc">
        <div class="post-toc__title" data-it="Indice" data-en="Table of contents">Table of contents</div>
        <ul class="post-toc__list">
          <li class="post-toc__item level-0"><a class="post-toc__link" href="#memory-first-and-tiered-storage">Memory-First and Tiered Storage</a></li><li class="post-toc__item level-0"><a class="post-toc__link" href="#cache-management-ram-vram-disk-and-gpu-offloading">Cache Management (RAM, VRAM, Disk) and GPU Offloading</a></li>
        </ul>
      </aside>
        <div class="post-body">
          <p>Kinetica allows organisations to process and analyse massive volumes of <strong>live data</strong> at high speed by harnessing GPUs instead of relying solely on conventional CPUs. It targets complex OLAP-style analytics workloads, including streaming data, geospatial functions, graph computations, and even in-database machine learning. In short, Kinetica aims to bridge the gap left by traditional databases when handling multi-source, real-time data at scale, unifying performance, horizontal scalability, location intelligence, and AI within a single platform.</p>
<p>The engine executes queries in a <strong>vectorised</strong> fashion, processing entire columns in batches rather than row by row, and maximises hardware parallelism.</p>
<p>Thanks to this architecture Kinetica claims it can execute queries over datasets containing billions of rows in mere milliseconds, without depending on heavy indexing or pre-aggregation.</p>
<p>Kinetica is a distributed, columnar, vectorised database that follows a <strong>memory-first</strong> design with tiered storage.</p>
<p>Data is automatically sharded across worker nodes; a head node receives SQL queries and breaks them into smaller tasks that workers execute in parallel. This yields near-linear scalability: adding nodes (each with additional compute and memory) increases throughput almost proportionally, so petabytes of data can be processed in tight SLAs.</p>
<p>Kinetica exposes an ANSI SQL-92 interface plus Postgres/JDBC/ODBC-compatible APIs, abstracting away the number and placement of nodes.</p>
<p><strong>Columnar store &amp; vectorisation.</strong> Internally, data is stored in a columnar layout (instead of row-major) much like analytic data warehouses. Columnar storage improves locality and compression — columns can be compressed effectively (dictionary encoding, etc.), reducing the memory footprint and accelerating transfers to GPU memory. The vectorised query engine automatically assigns each operation (filters, aggregations, joins, window functions, etc.) to the processor best suited for the task — CPU or GPU — based on where it can execute fastest. In practice Kinetica performs heterogeneous scheduling: highly parallel, compute-intensive operations are offloaded to GPU cores, while the CPU handles less parallel sections in tandem.</p>
<p>This hybrid approach delivers reported speed-ups of 50–100× over CPU-only execution. The engine is “GPU-aware”: it slices and orchestrates queries to exploit GPU acceleration whenever beneficial, yet preserves the flexibility and compatibility of a full distributed SQL database.</p>
<h2 id="memory-first-and-tiered-storage">Memory-First and Tiered Storage</h2>
<p>One of Kinetica’s pillars is intelligent memory management through a “memory-first” tiered storage design. In traditional systems data access is often bottlenecked by constant disk-to-RAM shuffling. Kinetica minimises that overhead by keeping hot data in fast memory and relegating less-used data to slower tiers.</p>
<p>Storage resources are divided into multiple tiers ordered by speed:</p>
<ul>
<li><strong>VRAM tier</strong> – GPU video memory, extremely close to GPU cores with very high bandwidth.</li>
<li><strong>RAM tier</strong> – system memory available on each node.</li>
<li><strong>Disk cache tier</strong> – local SSD/disk acting as an extended cache for transient data or intermediate results.</li>
<li><strong>Persist tier</strong> – primary durable storage (e.g., NVMe/SSD) where tables reside permanently.</li>
<li><strong>Cold storage tier</strong> – capacity storage such as HDFS, S3, or other external systems for historical or rarely accessed data.</li>
</ul>
<p>The core idea is to keep “hot” and “warm” data (frequently or recently accessed) in the fastest tiers — VRAM on the GPU and system RAM — while “cold” data (less critical or historical) can move to slower, cheaper media such as local disk or cloud object storage.</p>
<p>In a typical configuration you might keep two weeks of data in memory, while older partitions are evicted to disk or S3; policies can be predicate-driven (e.g., timestamp-based) and are fully configurable. The multi-tier system is managed automatically, with Kinetica retaining hot data in VRAM whenever possible.</p>
<p>Combining tiered storage with columnar compression lets Kinetica deliver high performance without requiring prohibitive amounts of RAM: only the most important data sits in the expensive fast tiers, and compression packs far more data into those tiers than you would expect.</p>
<h2 id="cache-management-ram-vram-disk-and-gpu-offloading">Cache Management (RAM, VRAM, Disk) and GPU Offloading</h2>
<p>VRAM acts as an ultra-fast L1 cache, RAM as a larger L2 cache, and local SSD/disk as L3.</p>
<ol>
<li>Kinetica’s resource manager dynamically decides where data should reside to satisfy each query. Any operation that runs on the GPU requires the relevant data to be present in the VRAM tier.</li>
</ol>
<p>To make movement efficient, Kinetica pre-allocates VRAM on each GPU node at start-up, reserving it as a buffer pool. This ensures dedicated VRAM capacity for the database and allows watermark/eviction policies to manage content. Similarly, you can configure a disk-cache area that acts as a “relief valve” for transient objects or to spill RAM when it fills up.</p>
<p>Cache optimisation therefore becomes a matter of keeping the “right” data in the fastest tiers. Kinetica monitors access patterns and can enforce predicate-based strategies (for example, “timestamp &lt; 2023 goes to cold storage”) to distribute table fragments automatically across VRAM, RAM, and persistent storage. The objective is to minimise disk I/O during queries.</p>
<p>The engine overlaps data loading with computation: while one batch is copied from RAM to VRAM, the GPU can already process another batch, forming a pipeline.</p>
<p>When datasets live in external storage (HDFS, S3, etc.), Kinetica can execute queries that join internal and external tables without fully ingesting them; it moves only relevant result segments to the GPU.</p>
<p>Another crucial aspect is GPU offloading — deciding which operations to “ship” to the GPU and which to keep on the CPU. Kinetica delegates highly parallel, compute-heavy tasks to GPU cores and leaves CPU-bound portions (those ill-suited for SIMD or not worth the transfer cost) on the CPU. Queries are decomposed into many vector tasks queued for parallel execution on the GPU.</p>
<p>Kinetica thus implements a balanced heterogeneous model: CPU and GPU work together. Query latency shrinks dramatically relative to CPU-only databases, while the system remains fully SQL-compliant. Kinetica is not alone in this philosophy — for instance, HeavyDB treats GPU memory as an L1 cache. Its optimiser pushes hot data to GPU memory for near-zero latency, then falls back to CPU (L2) or disk (L3) as needed. Kinetica’s differentiator lies in the explicit, customisable control over every memory tier: users can tune data placement down to specific columns or tables, whereas other systems automate most caching decisions.</p>
        </div>
      </section>
    </article>
  </main>
  <footer>
    <span data-it="© 2025 Mirko Calcaterra. Tutti i diritti riservati."
          data-en="© 2025 Mirko Calcaterra. All rights reserved.">
      © 2025 Mirko Calcaterra. Tutti i diritti riservati.
    </span>
  </footer>
  <script>
    const BLOG_LANG_KEY = 'blogLang';
    const BLOG_THEME_KEY = 'blogTheme';
    const CURRENT_LANG = "en";
    const OTHER_LANG = "it";
    const OTHER_LANG_LINK = "../../../blog/it/kinetica-cache-optimization/index.html";
    (function() {
      const body = document.body;
      const themeToggle = document.querySelector('.theme-toggle');
      const themeThumb = document.querySelector('.theme-toggle .theme-thumb');
      const langBtn = document.querySelector('.lang-btn');
      const tocLinks = Array.from(document.querySelectorAll('.post-toc__link'));
      const headingEntries = tocLinks
        .map((link) => {
          const id = link.getAttribute('href').slice(1);
          const target = document.getElementById(id);
          return target ? { link, target } : null;
        })
        .filter(Boolean);
      const storedTheme = (localStorage.getItem(BLOG_THEME_KEY) || '').toLowerCase();
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const initialTheme = storedTheme === 'light' ? 'light' : (storedTheme === 'dark' ? 'dark' : (prefersDark ? 'dark' : 'light'));
      let activeLink = null;
      let ticking = false;
      function applyTheme(theme) {
        const resolved = theme === 'dark' ? 'dark' : 'light';
        body.setAttribute('data-theme', resolved);
        if (themeToggle) {
          themeToggle.classList.toggle('active', resolved === 'dark');
        }
        if (themeThumb) {
          themeThumb.textContent = resolved === 'dark' ? '🌙' : '☀️';
        }
        localStorage.setItem(BLOG_THEME_KEY, resolved);
      }
      function setActive(link) {
        if (activeLink === link) {
          return;
        }
        if (activeLink) {
          activeLink.classList.remove('post-toc__link--active');
        }
        if (link) {
          link.classList.add('post-toc__link--active');
        }
        activeLink = link;
      }
      function updateActiveHeading() {
        if (!headingEntries.length) {
          return;
        }
        const scrollPosition = window.scrollY + 160;
        let current = headingEntries[0];
        for (const item of headingEntries) {
          if (item.target.offsetTop <= scrollPosition) {
            current = item;
          } else {
            break;
          }
        }
        setActive(current.link);
      }
      function onScroll() {
        if (ticking) {
          return;
        }
        ticking = true;
        window.requestAnimationFrame(() => {
          updateActiveHeading();
          ticking = false;
        });
      }
      applyTheme(initialTheme);
      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          applyTheme(body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        });
      }
      if (langBtn) {
        langBtn.textContent = CURRENT_LANG === 'it' ? 'EN' : 'IT';
        if (OTHER_LANG_LINK) {
          langBtn.addEventListener('click', () => {
            localStorage.setItem(BLOG_LANG_KEY, OTHER_LANG);
            window.location.href = OTHER_LANG_LINK;
          });
        } else {
          langBtn.disabled = true;
          langBtn.classList.add('lang-btn--disabled');
        }
      }
      localStorage.setItem(BLOG_LANG_KEY, CURRENT_LANG);
      if (headingEntries.length) {
        headingEntries.sort((a, b) => a.target.offsetTop - b.target.offsetTop);
        updateActiveHeading();
        window.addEventListener('scroll', onScroll, { passive: true });
      }
    })();
  </script>
</body>
</html>